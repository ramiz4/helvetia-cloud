# ============================================================================
# HELVETIA CLOUD - ENVIRONMENT CONFIGURATION
# ============================================================================
# This file contains all environment variables required to run Helvetia Cloud.
# Copy this file to .env and fill in your values.
#
# IMPORTANT: All variables marked as (REQUIRED) must be set before starting
# the application. The application validates environment variables on startup
# using Zod and will fail with clear error messages if required variables are
# missing or invalid.
# ============================================================================

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# PostgreSQL database connection string
# Format: postgresql://username:password@host:port/database
# Example: postgresql://helvetia:password@localhost:5432/helvetia_db
# (REQUIRED)
DATABASE_URL=your_value

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
# Redis connection string used for caching, queues, and rate limiting
# Format: redis://host:port or redis://username:password@host:port
# Example: redis://localhost:6379
# (REQUIRED)
REDIS_URL=your_value

# ============================================================================
# GITHUB OAUTH CONFIGURATION
# ============================================================================
# GitHub OAuth App credentials for user authentication
# Create an OAuth App at: https://github.com/settings/developers
# Set Authorization callback URL to: http://localhost:3000/auth/callback (for dev)
# (REQUIRED)
GITHUB_CLIENT_ID=your_value
GITHUB_CLIENT_SECRET=your_value

# GitHub webhook secret for verifying webhook payloads
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# Configure in GitHub repo: Settings > Webhooks > Add webhook
# (OPTIONAL - only needed if using webhooks for automated deployments)
GITHUB_WEBHOOK_SECRET=your_webhook_secret_value

# ============================================================================
# JWT AUTHENTICATION
# ============================================================================
# Secret key used for signing JWT tokens
# Generate a strong random string (at least 32 characters)
# Example: openssl rand -base64 32
# (REQUIRED)
JWT_SECRET=your_value

# Encryption key for encrypting sensitive data like GitHub access tokens
# MUST be exactly 32 characters long
# Generate with: node -e "console.log(require('crypto').randomBytes(16).toString('hex'))"
# (REQUIRED)
ENCRYPTION_KEY=your_32_character_encryption_key

# Cookie secret used for signing cookies
# Generate a strong random string (at least 32 characters)
# Example: openssl rand -base64 32
# (REQUIRED)
COOKIE_SECRET=your_value

# Salt for encryption key derivation (hex string)
# Generate with: node -e "console.log(require('crypto').randomBytes(16).toString('hex'))"
# (OPTIONAL - a default will be used in development if not set)
ENCRYPTION_SALT=your_random_hex_salt_value

# ============================================================================
# PLATFORM CONFIGURATION
# ============================================================================
# The domain where your platform is hosted (used for routing and DNS)
# Default: helvetia.cloud
PLATFORM_DOMAIN=helvetia.localhost

# Base URL for API requests from the dashboard
# Default: http://localhost:3001
# Note: The dashboard automatically appends /api/v1 for versioned endpoints
NEXT_PUBLIC_API_URL=http://localhost:3001

# WebSocket URL for real-time log streaming
# Default: ws://localhost:3001
NEXT_PUBLIC_WS_URL=ws://localhost:3001

# Dashboard application URL (used in OAuth callbacks and emails)
# Default: http://localhost:3000
NEXT_PUBLIC_APP_URL=http://localhost:3000
APP_BASE_URL=http://localhost:3000

# Node environment (development, production, or test)
# Default: development
NODE_ENV=development

# Admin credentials for initialization (optional)
# HELVETIA_ADMIN=admin
# HELVETIA_ADMIN_PASSWORD=admin

# ============================================================================
# CORS CONFIGURATION
# ============================================================================
# Comma-separated list of allowed origins for CORS
# Falls back to APP_BASE_URL if not set
# Example: http://localhost:3000,https://app.helvetia.cloud
# Default: Uses APP_BASE_URL value
ALLOWED_ORIGINS=http://localhost:3000

# ============================================================================
# RATE LIMITING CONFIGURATION
# ============================================================================
# Global rate limiting applies to all routes except health checks
# Health check endpoints (/health) are automatically excluded
# All limits use Redis-backed distributed storage for multi-instance deployments

# Global rate limiting (applies to most routes)
# Default: 100 requests per 1 minute
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW=1 minute

# Authentication endpoint rate limiting (stricter to prevent brute force attacks)
# Applies to /auth/* routes
# Default: 10 requests per 1 minute
AUTH_RATE_LIMIT_MAX=10
AUTH_RATE_LIMIT_WINDOW=1 minute

# WebSocket/SSE log and metrics streaming rate limiting
# Higher limit for SSE as reconnections are common
# Default: 100 connections per 1 minute
WS_RATE_LIMIT_MAX=100
WS_RATE_LIMIT_WINDOW=1 minute

# ============================================================================
# CONTAINER RESOURCE LIMITS
# ============================================================================
# Resource limits applied to each deployed container
# Adjust based on your server capacity and expected workload

# Memory limit per container in MB
# Default: 512
CONTAINER_MEMORY_LIMIT_MB=512

# CPU cores per container (can be fractional, e.g., 0.5, 1.5)
# Default: 1.0
CONTAINER_CPU_CORES=1.0

# ============================================================================
# SERVICE CONFIGURATION
# ============================================================================
# Operational parameters for service management and monitoring

# Maximum log size stored in database per service (in characters)
# Logs exceeding this limit are truncated
# Default: 50000
MAX_LOG_SIZE_CHARS=50000

# Interval for collecting and updating container metrics (in milliseconds)
# Lower values = more real-time data but higher resource usage
# Default: 5000 (5 seconds)
METRICS_UPDATE_INTERVAL_MS=5000

# Interval for reconciling service status across instances (in milliseconds)
# Ensures consistent state in multi-instance deployments
# Default: 30000 (30 seconds)
STATUS_RECONCILIATION_INTERVAL_MS=30000

# Server-Sent Events (SSE) connection timeout (in milliseconds)
# Connections are automatically closed after this duration
# Default: 1800000 (30 minutes)
CONNECTION_TIMEOUT_MS=1800000

# Port for worker health check HTTP server
# Used by orchestrators (Docker Compose, Kubernetes) for health checks
# Default: 3003
WORKER_HEALTH_PORT=3003

# ============================================================================
# DISTRIBUTED LOCK CONFIGURATION
# ============================================================================
# Redis-based distributed locks for coordinating operations across instances
# Prevents race conditions in multi-instance deployments

# Lock TTL (time-to-live) for status updates (in milliseconds)
# Lock is automatically released after this duration
# Default: 10000 (10 seconds)
STATUS_LOCK_TTL_MS=10000

# Lock TTL for status reconciliation operations (in milliseconds)
# Default: 5000 (5 seconds)
STATUS_RECONCILIATION_LOCK_TTL_MS=5000

# Base delay between lock acquisition retry attempts (in milliseconds)
# Default: 200
LOCK_RETRY_DELAY_MS=200

# Random jitter added to retry delay to prevent thundering herd (in milliseconds)
# Default: 100
LOCK_RETRY_JITTER_MS=100

# ============================================================================
# BODY SIZE LIMITS
# ============================================================================
# Request body size limits for different endpoints
# Protects against memory exhaustion from large payloads

# Global default body size limit (in MB)
# Applied to endpoints without specific limits
# Default: 10
BODY_LIMIT_GLOBAL_MB=10

# Standard body size limit (in MB)
# Applied to most API endpoints
# Default: 1
BODY_LIMIT_STANDARD_MB=1

# Small body size limit (in KB)
# Applied to lightweight endpoints (status checks, metadata)
# Default: 100
BODY_LIMIT_SMALL_KB=100

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
# Control application logging behavior and verbosity

# Log level: trace, debug, info, warn, error, fatal
# Lower levels include all higher levels (e.g., info includes warn, error, fatal)
# Default: info
LOG_LEVEL=info

# Enable logging of incoming HTTP requests
# Set to false to disable request logging
# Default: true
LOG_REQUESTS=true

# Enable logging of outgoing HTTP responses
# Set to false to disable response logging
# Default: true
LOG_RESPONSES=true

# ============================================================================
# DOCKER IMAGE CLEANUP CONFIGURATION
# ============================================================================
# Automatic cleanup of Docker images to manage disk space

# Number of days to keep old image versions
# Images older than this will be removed during cleanup
# Default: 7
IMAGE_RETENTION_DAYS=7

# Disk usage threshold percentage (0-100) to trigger aggressive cleanup
# When disk usage exceeds this threshold, cleanup removes more images
# Default: 80
DISK_USAGE_THRESHOLD_PERCENT=80

# Enable automatic cleanup of dangling images (untagged/unused images)
# Set to false to disable dangling image cleanup
# Default: true
CLEANUP_DANGLING_IMAGES=true

# Enable automatic cleanup of old image versions based on retention policy
# Set to false to disable old image cleanup
# Default: true
CLEANUP_OLD_IMAGES=true

# ============================================================================
# ERROR MONITORING CONFIGURATION (SENTRY)
# ============================================================================
# Sentry configuration for error tracking and monitoring
# Create a project at https://sentry.io and get your DSN

# Sentry DSN (Data Source Name) for error reporting
# This is a public token that's safe to include in client-side code
# Example: https://abc123@o123456.ingest.sentry.io/123456
# (OPTIONAL - error monitoring disabled if not set)
NEXT_PUBLIC_SENTRY_DSN=

# Sentry organization slug (required for source map uploads)
# Found in Sentry project settings
# (OPTIONAL - only needed for source map uploads)
SENTRY_ORG=

# Sentry project name (required for source map uploads)
# Found in Sentry project settings
# (OPTIONAL - only needed for source map uploads)
SENTRY_PROJECT=

# Sentry authentication token (required for source map uploads)
# Create at: https://sentry.io/settings/account/api/auth-tokens/
# Needs 'project:releases' and 'org:read' permissions
# (OPTIONAL - only needed for source map uploads)
SENTRY_AUTH_TOKEN=

# ============================================================================
# STRIPE BILLING CONFIGURATION
# ============================================================================
# Stripe API keys for payment processing
# Get your keys at: https://dashboard.stripe.com/apikeys
# Use test keys (starting with sk_test_) in development
# Use live keys (starting with sk_live_) in production
# (REQUIRED for billing features)
STRIPE_SECRET_KEY=your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=your_stripe_publishable_key

# Stripe webhook secret for verifying webhook signatures
# Create a webhook endpoint at: https://dashboard.stripe.com/webhooks
# Set the endpoint URL to: https://your-domain.com/api/v1/webhooks/stripe
# Select events: customer.subscription.*, invoice.*, payment_intent.*
# (REQUIRED for webhook handling)
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret

# Stripe price IDs for subscription plans
# Create products and prices at: https://dashboard.stripe.com/prices
# (REQUIRED for subscription features)
STRIPE_PRICE_ID_STARTER=your_stripe_starter_price_id
STRIPE_PRICE_ID_PRO=your_stripe_pro_price_id
STRIPE_PRICE_ID_ENTERPRISE=your_stripe_enterprise_price_id

# Stripe usage-based metering price IDs
# Create metered pricing at: https://dashboard.stripe.com/prices
# (REQUIRED for usage-based billing)
STRIPE_PRICE_ID_COMPUTE_HOURS=your_compute_hours_price_id
STRIPE_PRICE_ID_MEMORY_GB_HOURS=your_memory_price_id
STRIPE_PRICE_ID_BANDWIDTH_GB=your_bandwidth_price_id
STRIPE_PRICE_ID_STORAGE_GB=your_storage_price_id
