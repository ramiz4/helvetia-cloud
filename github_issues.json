[
  {
    "title": "[CRITICAL] Hardcoded Cryptographic Salt in Encryption",
    "labels": ["P0", "security", "critical", "bug"],
    "body": "The encryption module uses a hardcoded salt value `'salt'` for key derivation, which completely defeats the purpose of encryption and makes GitHub access tokens vulnerable to decryption.\n\n**Location:**\n`apps/api/src/utils/crypto.ts:8`\n\n**Current Code:**\n\n```typescript\nconst ENCRYPTION_KEY = crypto.scryptSync(KEY, 'salt', 32);\n```\n\n**Security Impact:**\n\n- GitHub access tokens are vulnerable to rainbow table attacks\n- If database is compromised, tokens can be easily decrypted\n- Violates cryptographic best practices\n\n**Recommended Fix:**\n\n```typescript\nconst SALT = process.env.ENCRYPTION_SALT || crypto.randomBytes(32).toString('hex');\nconst ENCRYPTION_KEY = crypto.scryptSync(KEY, SALT, 32);\n```\n\n**Better Solution:**\nUse a proper key management service (AWS KMS, HashiCorp Vault) or at minimum, store a secure random salt in environment variables.\n\n**Acceptance Criteria:**\n\n- [ ] Remove hardcoded salt\n- [ ] Generate unique salt per installation\n- [ ] Store salt securely in environment variables\n- [ ] Update .env.example with ENCRYPTION_SALT\n- [ ] Document migration path for existing encrypted data\n- [ ] Add tests for encryption/decryption",
    "number": 56,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/56",
    "synced": true
  },
  {
    "title": "[CRITICAL] Missing Rate Limiting Implementation",
    "labels": ["P0", "security", "critical", "enhancement"],
    "body": "Despite having rate limiting configuration in environment variables, no rate limiting is actually implemented. Critical endpoints are vulnerable to brute-force and DoS attacks.\n\n**Vulnerable Endpoints:**\n\n- `/auth/github` - OAuth callback (brute force risk)\n- `/services/:id/deploy` - Resource-intensive operations (DoS risk)\n- `/webhooks/github` - External webhook (abuse risk)\n- All authenticated endpoints\n\n**Impact:**\n\n- Brute-force attacks on authentication\n- DoS through excessive deployment requests\n- Webhook spam overwhelming the system\n- Resource exhaustion\n\n**Recommended Implementation:**\n\n```typescript\nimport rateLimit from '@fastify/rate-limit';\n\n// Global rate limiting\nfastify.register(rateLimit, {\n  max: parseInt(process.env.RATE_LIMIT_MAX || '100'),\n  timeWindow: process.env.RATE_LIMIT_WINDOW || '1 minute',\n  redis: redisConnection,\n  keyGenerator: (request) => request.ip,\n});\n\n// Stricter limit for auth routes\nfastify.register(\n  rateLimit,\n  {\n    max: parseInt(process.env.AUTH_RATE_LIMIT_MAX || '10'),\n    timeWindow: process.env.AUTH_RATE_LIMIT_WINDOW || '1 minute',\n    redis: redisConnection,\n  },\n  { prefix: '/auth' },\n);\n```\n\n**Acceptance Criteria:**\n\n- [ ] Install @fastify/rate-limit dependency\n- [ ] Implement global rate limiting\n- [ ] Implement stricter limits for authentication endpoints\n- [ ] Implement limits for deployment endpoints\n- [ ] Implement limits for WebSocket/SSE connections\n- [ ] Exclude /health endpoint from rate limiting\n- [ ] Add rate limit headers in responses\n- [ ] Add tests for rate limiting\n- [ ] Document rate limits in API docs",
    "number": 58,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/58",
    "synced": true
  },
  {
    "title": "[CRITICAL] GitHub Webhook Authentication Missing",
    "labels": ["P0", "security", "critical", "bug"],
    "body": "GitHub webhooks endpoint (`/webhooks/github`) processes requests without verifying the signature. Anyone can trigger deployments by sending POST requests to this endpoint.\n\n**Location:**\n`apps/api/src/server.ts:979-1152`\n\n**Current Code:**\n\n```typescript\nfastify.post('/webhooks/github', async (request) => {\n  const payload = request.body as any;\n  // No signature verification!\n```\n\n**Security Impact:**\n\n- Unauthorized deployments can be triggered\n- Malicious actors can cause resource exhaustion\n- Preview environments can be created/destroyed without authorization\n- Potential for code injection through malicious payloads\n\n**Recommended Fix:**\n\n```typescript\nimport crypto from 'crypto';\n\nfunction verifyGitHubSignature(payload: string, signature: string, secret: string): boolean {\n  const hmac = crypto.createHmac('sha256', secret);\n  const digest = 'sha256=' + hmac.update(payload).digest('hex');\n  return crypto.timingSafeEqual(Buffer.from(signature), Buffer.from(digest));\n}\n\nfastify.post('/webhooks/github', async (request, reply) => {\n  const signature = request.headers['x-hub-signature-256'] as string;\n\n  if (!signature) {\n    return reply.status(401).send({ error: 'Missing signature' });\n  }\n\n  const rawBody = JSON.stringify(request.body);\n\n  if (!verifyGitHubSignature(rawBody, signature, process.env.GITHUB_WEBHOOK_SECRET!)) {\n    return reply.status(401).send({ error: 'Invalid signature' });\n  }\n\n  // ... process webhook\n});\n```\n\n**Acceptance Criteria:**\n\n- [ ] Add GITHUB_WEBHOOK_SECRET to environment variables\n- [ ] Implement signature verification function\n- [ ] Add signature verification to webhook endpoint\n- [ ] Return 401 for missing or invalid signatures\n- [ ] Log suspicious requests\n- [ ] Add tests for signature verification\n- [ ] Update documentation with webhook setup instructions\n- [ ] Update .env.example",
    "number": 59,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/59",
    "synced": true
  },
  {
    "title": "[CRITICAL] Insecure CORS Configuration Allows Origin Reflection",
    "labels": ["P0", "security", "critical", "bug"],
    "body": "SSE endpoints reflect the request origin back in `Access-Control-Allow-Origin` header with credentials enabled, effectively bypassing CORS protection.\n\n**Locations:**\n\n- `apps/api/src/server.ts:654-661` (metrics stream)\n- `apps/api/src/server.ts:1199-1206` (logs stream)\n\n**Vulnerable Code:**\n\n```typescript\n'Access-Control-Allow-Origin': request.headers.origin || '*',\n'Access-Control-Allow-Credentials': 'true',\n```\n\n**Security Impact:**\n\n- Cross-origin attacks possible\n- Session hijacking risk\n- CSRF vulnerabilities\n- Sensitive data exposure to malicious origins\n\n**Recommended Fix:**\n\n```typescript\nconst allowedOrigins = (\n  process.env.ALLOWED_ORIGINS ||\n  process.env.APP_BASE_URL ||\n  'http://localhost:3000'\n)\n  .split(',')\n  .map((o) => o.trim());\n\nfastify.register(cors, {\n  origin: (origin, cb) => {\n    if (!origin || allowedOrigins.includes(origin)) {\n      cb(null, true);\n    } else {\n      cb(new Error('Not allowed by CORS'), false);\n    }\n  },\n  credentials: true,\n  methods: ['GET', 'POST', 'PATCH', 'DELETE', 'OPTIONS'],\n});\n\n// For SSE endpoints\nreply.raw.writeHead(200, {\n  'Content-Type': 'text/event-stream',\n  'Cache-Control': 'no-cache',\n  Connection: 'keep-alive',\n  'X-Accel-Buffering': 'no',\n  'Access-Control-Allow-Origin': allowedOrigins.includes(request.headers.origin || '')\n    ? request.headers.origin\n    : allowedOrigins[0],\n  'Access-Control-Allow-Credentials': 'true',\n});\n```\n\n**Acceptance Criteria:**\n\n- [ ] Add ALLOWED_ORIGINS environment variable\n- [ ] Implement strict origin validation\n- [ ] Fix CORS configuration in server setup\n- [ ] Fix CORS headers in SSE endpoints\n- [ ] Remove wildcard origin fallback\n- [ ] Add tests for CORS validation\n- [ ] Document CORS configuration\n- [ ] Update .env.example",
    "number": 60,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/60",
    "synced": true
  },
  {
    "title": "[CRITICAL] Host Filesystem Exposure via Docker Volume Mount",
    "labels": ["P0", "security", "critical", "bug"],
    "body": "Worker mounts the entire `/Users` directory into builder containers, exposing all user data on macOS. This is extremely dangerous.\n\n**Location:**\n`apps/worker/src/worker.ts:104, 216`\n\n**Vulnerable Code:**\n\n```typescript\nBinds: ['/var/run/docker.sock:/var/run/docker.sock', '/Users:/Users'],\n```\n\n**Security Impact:**\n\n- Container can access all user data on macOS\n- Host filesystem can be modified by container\n- Privilege escalation possible\n- Violates principle of least privilege\n- Data breach risk\n\n**Recommended Fix:**\n\n```typescript\n// Only mount specific workspace directory, read-only\nconst workDir = process.env.WORKSPACE_DIR || '/tmp/helvetia-workspaces';\n\n// Ensure directory exists\nawait fs.promises.mkdir(workDir, { recursive: true });\n\nBinds: [\n  '/var/run/docker.sock:/var/run/docker.sock',\n  `${workDir}:/workspaces:ro`, // Read-only mount\n],\n```\n\n**Additional Security:**\n\n- Use temporary directories that are cleaned up\n- Never mount root directories\n- Use SELinux/AppArmor labels\n- Consider using Docker volumes instead of bind mounts\n\n**Acceptance Criteria:**\n\n- [ ] Remove /Users mount completely\n- [ ] Create dedicated workspace directory\n- [ ] Mount workspace as read-only\n- [ ] Add WORKSPACE_DIR environment variable\n- [ ] Implement workspace cleanup\n- [ ] Add documentation warning about production usage\n- [ ] Add tests to verify mount configuration\n- [ ] Update .env.example",
    "number": 61,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/61",
    "synced": true
  },
  {
    "title": "[HIGH] SQL Injection Risk with Prisma String Operations",
    "labels": ["P1", "security", "bug"],
    "body": "Using `contains` with unsanitized user input in Prisma queries could be vulnerable to SQL injection or at minimum, unexpected behavior.\n\n**Location:**\nMultiple locations in `apps/api/src/server.ts`\n\n**Example:**\n\n```typescript\nwhere: {\n  repoUrl: {\n    contains: repoUrl;\n  }\n}\n```\n\n**Recommended Fix:**\n\n```typescript\nconst sanitizedRepoUrl = repoUrl.trim().replace(/\\.git$/, '');\nwhere: {\n  OR: [{ repoUrl: sanitizedRepoUrl }, { repoUrl: `${sanitizedRepoUrl}.git` }];\n}\n```\n\n**Acceptance Criteria:**\n\n- [ ] Audit all Prisma queries using user input\n- [ ] Sanitize repo URLs before querying\n- [ ] Use exact matches where possible\n- [ ] Add input validation tests\n- [ ] Document safe query patterns",
    "number": 66,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/66",
    "synced": true
  },
  {
    "title": "[HIGH] Missing Comprehensive Input Validation",
    "labels": ["P1", "security", "enhancement"],
    "body": "Service creation and update endpoints lack comprehensive input validation, allowing potentially malicious or malformed data.\n\n**Location:**\n`apps/api/src/server.ts:500-597`\n\n**Missing Validations:**\n\n- Service name format (could contain special characters)\n- URL validation for repoUrl\n- Command injection prevention for buildCommand/startCommand\n- Size limits for envVars\n- Branch name validation\n\n**Recommended Implementation:**\nUse Zod for schema validation:\n\n```typescript\nimport { z } from 'zod';\n\nconst ServiceCreateSchema = z.object({\n  name: z\n    .string()\n    .min(3)\n    .max(63)\n    .regex(/^[a-z0-9-]+$/),\n  repoUrl: z.string().url().optional(),\n  branch: z\n    .string()\n    .min(1)\n    .max(255)\n    .regex(/^[a-zA-Z0-9-_./]+$/),\n  buildCommand: z.string().max(1000).optional(),\n  startCommand: z.string().max(1000).optional(),\n  port: z.number().int().min(1).max(65535),\n  envVars: z.record(z.string()).optional(),\n  customDomain: z.string().max(255).optional(),\n  type: z.enum(['DOCKER', 'STATIC', 'POSTGRES', 'REDIS', 'MYSQL', 'COMPOSE']),\n  staticOutputDir: z.string().max(255).optional(),\n});\n```\n\n**Acceptance Criteria:**\n\n- [ ] Install zod dependency\n- [ ] Create validation schemas for all endpoints\n- [ ] Implement request validation middleware\n- [ ] Return detailed validation errors\n- [ ] Add tests for validation\n- [ ] Document API request/response schemas",
    "number": 67,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/67",
    "synced": true
  },
  {
    "title": "[HIGH] SSE Connection Token Expiration Not Handled",
    "labels": ["P1", "security", "bug"],
    "body": "Long-lived SSE connections don't re-validate JWT tokens, potentially allowing access after token expiration.\n\n**Locations:**\n\n- `apps/api/src/server.ts:650-705` (metrics)\n- `apps/api/src/server.ts:1184-1230` (logs)\n\n**Recommended Fix:**\nImplement periodic token validation in SSE streams.\n\n**Acceptance Criteria:**\n\n- [ ] Add periodic token validation (every 5 minutes)\n- [ ] Close connection on token expiration\n- [ ] Implement graceful reconnection on client side\n- [ ] Add tests for token expiration handling\n- [ ] Document SSE connection lifecycle",
    "number": 68,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/68",
    "synced": true
  },
  {
    "title": "[HIGH] Incomplete Error Handling in Worker Deployment",
    "labels": ["P1", "bug", "reliability"],
    "body": "Worker's catch block doesn't handle partial failures properly. Resources may not be cleaned up correctly on deployment failure.\n\n**Location:**\n`apps/worker/src/worker.ts:435-445`\n\n**Issues:**\n\n- Builder container might not be cleaned up\n- Old containers might not be restarted on rollback\n- No rollback mechanism for failed deployments\n\n**Acceptance Criteria:**\n\n- [ ] Implement comprehensive cleanup in catch block\n- [ ] Add rollback to previous container on failure\n- [ ] Ensure builder container always cleaned up\n- [ ] Log detailed error information\n- [ ] Add tests for failure scenarios\n- [ ] Update deployment status correctly on all paths",
    "number": 70,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/70",
    "synced": true
  },
  {
    "title": "[HIGH] Race Condition in Service Status Updates",
    "labels": ["P1", "bug", "concurrency"],
    "body": "Service status is updated from multiple places without synchronization, leading to race conditions and stale data.\n\n**Locations:**\n\n- API sets status to DEPLOYING when queuing\n- Worker sets status after deployment\n- Docker status checked asynchronously\n\n**Recommended Solution:**\nImplement Redis-based distributed locks using Redlock.\n\n**Acceptance Criteria:**\n\n- [ ] Install redlock dependency\n- [ ] Implement distributed locking for status updates\n- [ ] Create status reconciliation service\n- [ ] Add tests for concurrent updates\n- [ ] Document status lifecycle",
    "number": 71,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/71",
    "synced": true
  },
  {
    "title": "[HIGH] Docker Socket Security Risk",
    "labels": ["P1", "security", "architecture"],
    "body": "Direct Docker socket access in both API and Worker provides root-level access to host system.\n\n**Impact:**\n\n- Container escape vulnerabilities\n- Host system compromise potential\n- Privilege escalation risks\n\n**Recommended Solutions:**\n\n1. Run Docker daemon in rootless mode\n2. Implement Docker socket proxy with ACLs\n3. Consider migrating to Kubernetes\n\n**Acceptance Criteria:**\n\n- [ ] Document security implications\n- [ ] Implement Docker socket proxy\n- [ ] Add SELinux/AppArmor policies\n- [ ] Create security hardening guide\n- [ ] Consider Kubernetes migration path",
    "number": 72,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/72",
    "synced": true
  },
  {
    "title": "[HIGH] Memory Leak Risk in SSE Connections",
    "labels": ["P1", "bug", "performance"],
    "body": "SSE connection intervals may not be properly cleaned up on errors, leading to memory leaks.\n\n**Location:**\n`apps/api/src/server.ts:650-705`\n\n**Recommended Fix:**\nAdd comprehensive error handling and cleanup.\n\n**Acceptance Criteria:**\n\n- [ ] Add error handling in interval callbacks\n- [ ] Ensure cleanup on all error paths\n- [ ] Add connection state tracking\n- [ ] Implement connection timeout\n- [ ] Add tests for error scenarios\n- [ ] Monitor memory usage",
    "number": 73,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/73",
    "synced": true
  },
  {
    "title": "[HIGH] Unrestricted Service Deletion Risk",
    "labels": ["P1", "bug", "data-loss"],
    "body": "Service deletion is permanent and irreversible without safety mechanisms.\n\n**Recommended Implementation:**\nImplement soft deletion with retention period.\n\n**Acceptance Criteria:**\n\n- [ ] Add deletedAt field to Service model\n- [ ] Implement soft deletion\n- [ ] Add delete protection flag\n- [ ] Schedule cleanup after retention period\n- [ ] Add recovery mechanism\n- [ ] Require re-authentication for deletion\n- [ ] Add tests for deletion flow",
    "number": 74,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/74",
    "synced": true
  },
  {
    "title": "[MEDIUM] Missing Dockerfile Generation Validation",
    "labels": ["P2", "enhancement", "reliability"],
    "body": "Generated Dockerfiles aren't validated before build, leading to hard-to-debug failures.\n\n**Location:**\n`apps/worker/src/worker.ts:225-310`\n\n**Acceptance Criteria:**\n\n- [ ] Add Dockerfile syntax validation\n- [ ] Implement dry-run before build\n- [ ] Validate environment variable format\n- [ ] Add better error messages\n- [ ] Add tests for various scenarios",
    "number": 75,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/75",
    "synced": true
  },
  {
    "title": "[MEDIUM] Hardcoded Magic Numbers Throughout Codebase",
    "labels": ["P2", "refactoring", "maintainability"],
    "body": "Magic numbers scattered throughout code reduce maintainability.\n\n**Examples:**\n\n- `512 * 1024 * 1024` (Memory limit)\n- `1000000000` (CPU limit)\n- `5000` (Metrics interval)\n\n**Acceptance Criteria:**\n\n- [ ] Create constants configuration file\n- [ ] Extract all magic numbers\n- [ ] Make limits configurable via env vars\n- [ ] Update documentation\n- [ ] Add tests with different configurations",
    "number": 76,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/76",
    "synced": true
  },
  {
    "title": "[MEDIUM] Missing Request/Response Logging",
    "labels": ["P2", "observability", "enhancement"],
    "body": "No structured logging for requests and responses, making debugging difficult.\n\n**Acceptance Criteria:**\n\n- [ ] Implement request logging hook\n- [ ] Implement response logging hook\n- [ ] Add structured logging with context\n- [ ] Configure log levels per environment\n- [ ] Add request ID correlation\n- [ ] Document logging format",
    "number": 77,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/77",
    "synced": true
  },
  {
    "title": "[MEDIUM] No Health Check Endpoint for Worker",
    "labels": ["P2", "observability", "enhancement"],
    "body": "Worker service lacks health check endpoint for monitoring.\n\n**Acceptance Criteria:**\n\n- [ ] Add HTTP health endpoint\n- [ ] Include queue stats\n- [ ] Include Redis connection status\n- [ ] Include uptime information\n- [ ] Document health check format\n- [ ] Add monitoring setup guide",
    "number": 78,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/78",
    "synced": true
  },
  {
    "title": "[MEDIUM] Incomplete Test Coverage",
    "labels": ["P2", "testing", "quality"],
    "body": "Test suite exists but critical paths aren't fully covered.\n\n**Missing Tests:**\n\n- Integration tests for deployment flow\n- Webhook processing tests\n- SSE streaming tests\n- Worker deployment tests (currently failing)\n\n**Acceptance Criteria:**\n\n- [ ] Fix failing worker tests\n- [ ] Add integration tests\n- [ ] Achieve 80% code coverage minimum\n- [ ] Add E2E tests for critical flows\n- [ ] Set up test containers for integration tests\n- [ ] Add coverage reporting to CI",
    "number": 79,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/79",
    "synced": true
  },
  {
    "title": "[MEDIUM] Environment Variable Management Needs Improvement",
    "labels": ["P2", "enhancement", "configuration"],
    "body": "No validation for required environment variables, leading to potential runtime errors.\n\n**Acceptance Criteria:**\n\n- [ ] Install zod for validation\n- [ ] Create environment schema\n- [ ] Validate on startup\n- [ ] Provide clear error messages\n- [ ] Add type safety for env vars\n- [ ] Update documentation",
    "number": 80,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/80",
    "synced": true
  },
  {
    "title": "[MEDIUM] No Database Migration Strategy",
    "labels": ["P2", "database", "deployment"],
    "body": "Using `db:push` instead of migrations is dangerous for production.\n\n**Issues:**\n\n- No migration history\n- Can cause data loss\n- Can't rollback changes\n- No team collaboration on schema changes\n\n**Acceptance Criteria:**\n\n- [ ] Switch to Prisma Migrate\n- [ ] Create initial migration\n- [ ] Update deployment scripts\n- [ ] Document migration workflow\n- [ ] Add rollback procedures\n- [ ] Update CI/CD pipeline",
    "number": 81,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/81",
    "synced": true
  },
  {
    "title": "[MEDIUM] Frontend State Management Issues",
    "labels": ["P2", "frontend", "performance"],
    "body": "Dashboard has performance issues and state management anti-patterns.\n\n**Issues:**\n\n- Services fetched on every re-render\n- No caching mechanism\n- Large component needs splitting\n- Optimistic updates without proper rollback\n\n**Acceptance Criteria:**\n\n- [ ] Install React Query or SWR\n- [ ] Implement data caching\n- [ ] Split large components\n- [ ] Add error boundaries\n- [ ] Implement proper loading states\n- [ ] Add tests for state management",
    "number": 82,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/82",
    "synced": true
  },
  {
    "title": "[MEDIUM] Docker Image Cleanup Missing",
    "labels": ["P2", "infrastructure", "resource-management"],
    "body": "No cleanup for dangling, failed, or old Docker images, leading to disk space issues.\n\n**Acceptance Criteria:**\n\n- [ ] Implement periodic cleanup job\n- [ ] Remove dangling images\n- [ ] Remove old image versions\n- [ ] Add retention policy\n- [ ] Monitor disk usage\n- [ ] Add configuration options",
    "number": 83,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/83",
    "synced": true
  },
  {
    "title": "[MEDIUM] Missing Prometheus Metrics",
    "labels": ["P2", "observability", "monitoring"],
    "body": "No metrics exported for system monitoring.\n\n**Needed Metrics:**\n\n- Request rates and latencies\n- Error rates\n- Deployment success/failure rates\n- Queue depths\n- Resource usage\n\n**Acceptance Criteria:**\n\n- [ ] Install prom-client\n- [ ] Add /metrics endpoint\n- [ ] Implement custom metrics\n- [ ] Add Grafana dashboard\n- [ ] Document metrics\n- [ ] Set up alerting",
    "number": 84,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/84",
    "synced": true
  },
  {
    "title": "[MEDIUM] Session Management Needs Refresh Tokens",
    "labels": ["P2", "security", "enhancement"],
    "body": "JWT tokens have 7-day expiration with no refresh mechanism.\n\n**Acceptance Criteria:**\n\n- [ ] Implement refresh token flow\n- [ ] Use short-lived access tokens (15 min)\n- [ ] Implement token rotation\n- [ ] Add token revocation list in Redis\n- [ ] Update frontend to handle refresh\n- [ ] Add tests for token lifecycle",
    "number": 69,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/69",
    "synced": true
  },
  {
    "title": "[MEDIUM] No Request Size Limits",
    "labels": ["P2", "security", "performance"],
    "body": "Missing request body size limits could allow DoS attacks.\n\n**Acceptance Criteria:**\n\n- [ ] Add body size limit to Fastify config\n- [ ] Configure appropriate limits (10MB default)\n- [ ] Add limits per endpoint type\n- [ ] Document size limits\n- [ ] Add tests for size validation\n- [ ] Return appropriate error messages",
    "number": 85,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/85",
    "synced": true
  },
  {
    "title": "[LOW] Excessive TypeScript `any` Usage",
    "labels": ["P3", "refactoring", "type-safety"],
    "body": "Extensive use of `any` type reduces type safety benefits.\n\n**Acceptance Criteria:**\n\n- [ ] Add Fastify type augmentation\n- [ ] Create proper request/response types\n- [ ] Remove `as any` casts\n- [ ] Enable stricter TypeScript checks\n- [ ] Document type patterns",
    "number": 93,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/93",
    "synced": true
  },
  {
    "title": "[LOW] Inconsistent Error Messages",
    "labels": ["P3", "ux", "enhancement"],
    "body": "Error messages aren't user-friendly or consistent.\n\n**Acceptance Criteria:**\n\n- [ ] Create error response standard\n- [ ] Add error codes\n- [ ] Make messages user-friendly\n- [ ] Add i18n support for errors\n- [ ] Document error codes\n- [ ] Update frontend error handling",
    "number": 87,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/87",
    "synced": true
  },
  {
    "title": "[LOW] Missing API Versioning",
    "labels": ["P3", "api", "architecture"],
    "body": "No API versioning strategy makes future changes risky.\n\n**Acceptance Criteria:**\n\n- [ ] Add version prefix (/api/v1)\n- [ ] Document versioning strategy\n- [ ] Plan v2 transition path\n- [ ] Update frontend API calls\n- [ ] Add version negotiation",
    "number": 88,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/88",
    "synced": true
  },
  {
    "title": "[LOW] No Request ID Tracing",
    "labels": ["P3", "observability", "enhancement"],
    "body": "Missing correlation IDs makes request tracing difficult.\n\n**Acceptance Criteria:**\n\n- [ ] Add request ID generation\n- [ ] Propagate IDs across services\n- [ ] Include in all log entries\n- [ ] Return in response headers\n- [ ] Document tracing setup",
    "number": 89,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/89",
    "synced": true
  },
  {
    "title": "[LOW] Lack of Feature Flags",
    "labels": ["P3", "deployment", "enhancement"],
    "body": "No way to enable/disable features without deployment.\n\n**Acceptance Criteria:**\n\n- [ ] Choose feature flag service\n- [ ] Implement feature flag checks\n- [ ] Add admin UI for flags\n- [ ] Document feature flag usage\n- [ ] Add A/B testing capability",
    "number": 90,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/90",
    "synced": true
  },
  {
    "title": "[LOW] No Graceful Shutdown",
    "labels": ["P3", "reliability", "enhancement"],
    "body": "Services don't handle SIGTERM/SIGINT gracefully.\n\n**Acceptance Criteria:**\n\n- [ ] Implement graceful shutdown\n- [ ] Wait for in-flight requests\n- [ ] Close connections properly\n- [ ] Update deployment docs\n- [ ] Add tests for shutdown",
    "number": 91,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/91",
    "synced": true
  },
  {
    "title": "[LOW] Dashboard Accessibility Issues",
    "labels": ["P3", "accessibility", "a11y", "frontend"],
    "body": "Several accessibility improvements needed for WCAG compliance.\n\n**Issues:**\n\n- Missing ARIA labels\n- Insufficient color contrast\n- No keyboard navigation hints\n- Modal focus trap not complete\n\n**Acceptance Criteria:**\n\n- [ ] Run axe-core audit\n- [ ] Fix all critical a11y issues\n- [ ] Add ARIA labels\n- [ ] Improve color contrast\n- [ ] Implement proper focus management\n- [ ] Add keyboard navigation\n- [ ] Test with screen readers",
    "number": 92,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/92",
    "synced": true
  },
  {
    "title": "[EPIC] Comprehensive Codebase Refactoring: SOLID, DRY, and YAGNI Principles",
    "labels": ["P0", "epic", "refactoring", "architecture", "technical-debt"],
    "body": "# ğŸ—ï¸ Comprehensive Codebase Refactoring Initiative\n\n## Executive Summary\n\nThis epic outlines a comprehensive refactoring initiative to transform the Helvetia Cloud codebase into a world-class, production-ready platform that strictly adheres to software engineering best practices. As a principal software architect would approach this, we will systematically apply **SOLID**, **DRY**, and **YAGNI** principles to create a maintainable, scalable, and robust architecture.\n\n## ğŸ¯ Mission Statement\n\nTransform the current monolithic, tightly-coupled architecture into a clean, modular, and extensible system that:\n- Reduces technical debt by 80%\n- Improves maintainability and testability\n- Enables rapid feature development\n- Ensures long-term scalability\n- Adheres to enterprise-grade coding standards\n\n---\n\n## ğŸ“Š Current State Analysis\n\n### Critical Issues Identified\n\n#### 1. **Monolithic God Objects** ğŸ”´\n- `apps/api/src/server.ts`: **1,882 lines** - Violates Single Responsibility Principle\n- `apps/worker/src/worker.ts`: **565 lines** - Multiple concerns in single file\n- Mixed concerns: routing, business logic, data access, infrastructure\n\n#### 2. **Tight Coupling & Poor Separation of Concerns** ğŸ”´\n- Direct Docker API calls embedded in route handlers\n- Prisma queries scattered throughout route logic\n- No service layer abstraction\n- HTTP layer tightly coupled to business logic\n- Infrastructure concerns mixed with domain logic\n\n#### 3. **Massive Code Duplication** ğŸŸ¡\n- Container management logic duplicated across API and Worker\n- Status determination logic repeated in multiple locations\n- Metrics collection duplicated\n- Error handling patterns inconsistent and repeated\n- CORS validation logic duplicated\n\n#### 4. **Insufficient Abstraction** ğŸŸ¡\n- Direct dependency on concrete implementations (Docker, Redis, Prisma)\n- No interfaces or dependency injection\n- Hard to test due to tight coupling\n- Impossible to swap implementations\n\n#### 5. **Over-Engineering (YAGNI Violations)** ğŸŸ¡\n- Complex status determination with multiple edge cases\n- Premature optimization in some areas\n- Features implemented without clear requirements\n\n#### 6. **Poor Type Safety** ğŸŸ¡\n- Excessive use of `any` type throughout codebase\n- Missing proper TypeScript interfaces\n- No type guards for runtime validation\n- Type assertions (`as any`) used as workarounds\n\n#### 7. **Insufficient Error Handling** ğŸ”´\n- Inconsistent error handling patterns\n- Silent failures in critical paths\n- No centralized error handling strategy\n- Stack traces exposed to clients\n\n---\n\n## ğŸ“ SOLID Principles Violations\n\n### S - Single Responsibility Principle\n\n**Current Violations:**\n\n```typescript\n// apps/api/src/server.ts - One file handles:\n// 1. HTTP routing\n// 2. Authentication & authorization\n// 3. Business logic for services\n// 4. Docker container management\n// 5. Database operations\n// 6. WebSocket/SSE streaming\n// 7. Webhook processing\n// 8. Metrics collection\n// 9. Log streaming\n```\n\n**Impact:**\n- Impossible to change one aspect without affecting others\n- Testing requires mocking entire system\n- New developers overwhelmed by complexity\n- High risk of regression bugs\n\n**Solution:**\n- Extract route handlers to dedicated controllers\n- Create service layer for business logic\n- Separate repository layer for data access\n- Create infrastructure adapters\n\n### O - Open/Closed Principle\n\n**Current Violations:**\n\n```typescript\n// Hardcoded service type checks throughout codebase\nif (type === 'POSTGRES') {\n  // ...\n} else if (type === 'REDIS') {\n  // ...\n} else if (type === 'MYSQL') {\n  // ...\n}\n// Adding new service type requires modifying multiple files\n```\n\n**Impact:**\n- Cannot add new service types without modifying existing code\n- High coupling between service types and deployment logic\n- Violates DRY - type-specific logic scattered everywhere\n\n**Solution:**\n- Implement Strategy Pattern for service types\n- Create abstract ServiceDeployer interface\n- Implement concrete deployers: DockerServiceDeployer, StaticServiceDeployer, DatabaseServiceDeployer\n\n### L - Liskov Substitution Principle\n\n**Current State:**\n- No inheritance hierarchy to evaluate\n- No interfaces or abstractions to substitute\n\n**Opportunity:**\n- Create proper abstraction hierarchies\n- Ensure derived classes are substitutable\n\n### I - Interface Segregation Principle\n\n**Current Violations:**\n- No interfaces defined\n- Components depend on concrete implementations\n- Fat service objects with multiple responsibilities\n\n**Solution:**\n- Define small, focused interfaces\n- Segregate concerns into separate contracts\n\n### D - Dependency Inversion Principle\n\n**Current Violations:**\n\n```typescript\n// High-level modules depend on low-level modules\nconst docker = new Docker(); // Direct instantiation\nconst redis = new IORedis(url); // Direct instantiation\nimport { prisma } from 'database'; // Direct import\n```\n\n**Impact:**\n- Cannot mock dependencies for testing\n- Cannot swap implementations\n- Cannot configure differently per environment\n- Tight coupling to infrastructure\n\n**Solution:**\n- Introduce dependency injection container\n- Define interfaces for all external dependencies\n- Inject dependencies through constructors\n\n---\n\n## ğŸ”„ DRY Principle Violations\n\n### 1. Container Management Duplication\n\n**Location:** `apps/api/src/server.ts` and `apps/worker/src/worker.ts`\n\n**Duplicated Logic:**\n- Container listing and filtering\n- Container creation and configuration\n- Container lifecycle management\n- Volume management\n- Network setup\n- Health check configuration\n\n**Solution:**\n- Create `ContainerService` class\n- Centralize container operations\n- Share between API and Worker\n\n### 2. Status Determination Logic\n\n**Location:** Multiple functions across API\n\n```typescript\n// Pattern repeated 4+ times\nif (service.status === 'DEPLOYING') return 'DEPLOYING';\nif (containers.some(c => c.State === 'running')) return 'RUNNING';\n// ... etc\n```\n\n**Solution:**\n- Create `ServiceStatusResolver` class\n- Single source of truth for status logic\n- Testable in isolation\n\n### 3. Metrics Collection\n\n**Duplicated across:**\n- SSE endpoints\n- WebSocket endpoints\n- REST endpoints\n\n**Solution:**\n- Create `MetricsCollector` service\n- Unified metrics interface\n\n### 4. Log Scrubbing\n\n**Location:** Multiple places handling secret redaction\n\n**Solution:**\n- Already has `createScrubber` utility âœ…\n- Ensure consistent usage everywhere\n\n### 5. CORS and Security Headers\n\n**Duplicated logic:**\n- Origin validation in multiple places\n- Security headers repeated in SSE endpoints\n- Auth validation scattered\n\n**Solution:**\n- Create middleware/hooks for common concerns\n- Centralize security logic\n\n---\n\n## âš¡ YAGNI Principle Violations\n\n### 1. Over-Engineered Status System\n\n**Issue:**\n- Complex status determination with many edge cases\n- Multiple overlapping status types\n- Premature optimization for scenarios that don't exist\n\n**Solution:**\n- Simplify to essential states\n- Remove unused state transitions\n- Document actual requirements\n\n### 2. Unused Configuration Options\n\n**Issue:**\n- Many environment variables defined but not used\n- Configuration options for features not implemented\n\n**Solution:**\n- Audit and remove unused config\n- Add config only when feature is implemented\n\n### 3. Premature Abstractions\n\n**Issue:**\n- Some utility functions only used once\n- Complex helpers for simple operations\n\n**Solution:**\n- Inline single-use utilities\n- Simplify over-abstracted code\n- Extract abstractions only when pattern repeats 3+ times\n\n---\n\n## ğŸ—ï¸ Proposed Architecture\n\n### Layered Architecture (Clean Architecture)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                     Presentation Layer                      â”‚\nâ”‚  (Controllers, HTTP Routes, WebSocket/SSE Handlers)         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                            â”‚\n                            â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                     Application Layer                       â”‚\nâ”‚  (Use Cases, Application Services, DTOs, Validation)        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                            â”‚\n                            â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                      Domain Layer                           â”‚\nâ”‚  (Business Logic, Domain Services, Entities, Value Objects) â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                            â”‚\n                            â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   Infrastructure Layer                       â”‚\nâ”‚  (Repositories, External APIs, Docker, Redis, Database)     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### New Directory Structure\n\n```\napps/api/src/\nâ”œâ”€â”€ presentation/\nâ”‚   â”œâ”€â”€ controllers/\nâ”‚   â”‚   â”œâ”€â”€ ServiceController.ts\nâ”‚   â”‚   â”œâ”€â”€ DeploymentController.ts\nâ”‚   â”‚   â”œâ”€â”€ AuthController.ts\nâ”‚   â”‚   â””â”€â”€ WebhookController.ts\nâ”‚   â”œâ”€â”€ middlewares/\nâ”‚   â”‚   â”œâ”€â”€ authMiddleware.ts\nâ”‚   â”‚   â”œâ”€â”€ validationMiddleware.ts\nâ”‚   â”‚   â”œâ”€â”€ errorMiddleware.ts\nâ”‚   â”‚   â””â”€â”€ rateLimitMiddleware.ts\nâ”‚   â”œâ”€â”€ routes/\nâ”‚   â”‚   â”œâ”€â”€ serviceRoutes.ts\nâ”‚   â”‚   â”œâ”€â”€ deploymentRoutes.ts\nâ”‚   â”‚   â”œâ”€â”€ authRoutes.ts\nâ”‚   â”‚   â””â”€â”€ webhookRoutes.ts\nâ”‚   â””â”€â”€ streams/\nâ”‚       â”œâ”€â”€ MetricsStreamHandler.ts\nâ”‚       â””â”€â”€ LogStreamHandler.ts\nâ”œâ”€â”€ application/\nâ”‚   â”œâ”€â”€ services/\nâ”‚   â”‚   â”œâ”€â”€ ServiceManagementService.ts\nâ”‚   â”‚   â”œâ”€â”€ DeploymentOrchestrator.ts\nâ”‚   â”‚   â”œâ”€â”€ AuthenticationService.ts\nâ”‚   â”‚   â””â”€â”€ WebhookProcessor.ts\nâ”‚   â”œâ”€â”€ dtos/\nâ”‚   â”‚   â”œâ”€â”€ CreateServiceDto.ts\nâ”‚   â”‚   â”œâ”€â”€ UpdateServiceDto.ts\nâ”‚   â”‚   â””â”€â”€ DeploymentDto.ts\nâ”‚   â””â”€â”€ validators/\nâ”‚       â””â”€â”€ schemas/\nâ”œâ”€â”€ domain/\nâ”‚   â”œâ”€â”€ entities/\nâ”‚   â”‚   â”œâ”€â”€ Service.ts\nâ”‚   â”‚   â”œâ”€â”€ Deployment.ts\nâ”‚   â”‚   â””â”€â”€ User.ts\nâ”‚   â”œâ”€â”€ value-objects/\nâ”‚   â”‚   â”œâ”€â”€ ServiceStatus.ts\nâ”‚   â”‚   â”œâ”€â”€ DeploymentConfig.ts\nâ”‚   â”‚   â””â”€â”€ ResourceLimits.ts\nâ”‚   â”œâ”€â”€ services/\nâ”‚   â”‚   â”œâ”€â”€ ServiceStatusResolver.ts\nâ”‚   â”‚   â”œâ”€â”€ DeploymentStrategy.ts\nâ”‚   â”‚   â””â”€â”€ HealthChecker.ts\nâ”‚   â””â”€â”€ interfaces/\nâ”‚       â”œâ”€â”€ IServiceRepository.ts\nâ”‚       â”œâ”€â”€ IDeploymentRepository.ts\nâ”‚       â”œâ”€â”€ IContainerOrchestrator.ts\nâ”‚       â””â”€â”€ IDeploymentQueue.ts\nâ”œâ”€â”€ infrastructure/\nâ”‚   â”œâ”€â”€ repositories/\nâ”‚   â”‚   â”œâ”€â”€ ServiceRepository.ts\nâ”‚   â”‚   â”œâ”€â”€ DeploymentRepository.ts\nâ”‚   â”‚   â””â”€â”€ UserRepository.ts\nâ”‚   â”œâ”€â”€ container/\nâ”‚   â”‚   â”œâ”€â”€ DockerContainerOrchestrator.ts\nâ”‚   â”‚   â”œâ”€â”€ ContainerConfigBuilder.ts\nâ”‚   â”‚   â””â”€â”€ ContainerHealthMonitor.ts\nâ”‚   â”œâ”€â”€ queue/\nâ”‚   â”‚   â”œâ”€â”€ BullMQAdapter.ts\nâ”‚   â”‚   â””â”€â”€ DeploymentQueue.ts\nâ”‚   â”œâ”€â”€ cache/\nâ”‚   â”‚   â””â”€â”€ RedisCache.ts\nâ”‚   â””â”€â”€ external/\nâ”‚       â”œâ”€â”€ GitHubApiClient.ts\nâ”‚       â””â”€â”€ TraefikConfigManager.ts\nâ”œâ”€â”€ shared/\nâ”‚   â”œâ”€â”€ di/\nâ”‚   â”‚   â””â”€â”€ container.ts (Dependency Injection)\nâ”‚   â”œâ”€â”€ config/\nâ”‚   â”‚   â””â”€â”€ config.ts\nâ”‚   â”œâ”€â”€ errors/\nâ”‚   â”‚   â”œâ”€â”€ AppError.ts\nâ”‚   â”‚   â”œâ”€â”€ ValidationError.ts\nâ”‚   â”‚   â””â”€â”€ errorHandler.ts\nâ”‚   â””â”€â”€ utils/\nâ”‚       â”œâ”€â”€ logger.ts\nâ”‚       â””â”€â”€ crypto.ts\nâ””â”€â”€ index.ts (Application Bootstrap)\n\napps/worker/src/\nâ”œâ”€â”€ application/\nâ”‚   â”œâ”€â”€ DeploymentWorker.ts\nâ”‚   â”œâ”€â”€ strategies/\nâ”‚   â”‚   â”œâ”€â”€ IDeploymentStrategy.ts\nâ”‚   â”‚   â”œâ”€â”€ DockerDeploymentStrategy.ts\nâ”‚   â”‚   â”œâ”€â”€ StaticDeploymentStrategy.ts\nâ”‚   â”‚   â”œâ”€â”€ DatabaseDeploymentStrategy.ts\nâ”‚   â”‚   â””â”€â”€ ComposeDeploymentStrategy.ts\nâ”‚   â””â”€â”€ builders/\nâ”‚       â”œâ”€â”€ DockerfileBuilder.ts\nâ”‚       â””â”€â”€ ComposeFileBuilder.ts\nâ”œâ”€â”€ domain/\nâ”‚   â”œâ”€â”€ DeploymentJob.ts\nâ”‚   â””â”€â”€ BuildContext.ts\nâ”œâ”€â”€ infrastructure/\nâ”‚   â”œâ”€â”€ container/\nâ”‚   â”‚   â””â”€â”€ (shared with API)\nâ”‚   â””â”€â”€ git/\nâ”‚       â””â”€â”€ GitCloner.ts\nâ””â”€â”€ index.ts\n\npackages/shared/ (New shared package)\nâ”œâ”€â”€ domain/\nâ”‚   â”œâ”€â”€ interfaces/\nâ”‚   â”‚   â”œâ”€â”€ IContainerOrchestrator.ts\nâ”‚   â”‚   â”œâ”€â”€ ILogger.ts\nâ”‚   â”‚   â””â”€â”€ ICache.ts\nâ”‚   â””â”€â”€ types/\nâ”‚       â”œâ”€â”€ ServiceTypes.ts\nâ”‚       â””â”€â”€ StatusTypes.ts\nâ”œâ”€â”€ infrastructure/\nâ”‚   â”œâ”€â”€ container/\nâ”‚   â”‚   â”œâ”€â”€ ContainerService.ts\nâ”‚   â”‚   â”œâ”€â”€ VolumeManager.ts\nâ”‚   â”‚   â””â”€â”€ NetworkManager.ts\nâ”‚   â””â”€â”€ logging/\nâ”‚       â””â”€â”€ LogScrubber.ts\nâ””â”€â”€ utils/\n    â”œâ”€â”€ statusLock.ts\n    â””â”€â”€ workspace.ts\n```\n\n---\n\n## ğŸ“‹ Implementation Phases\n\n### Phase 1: Foundation & Setup (Week 1-2)\n**Priority: P0**\n\n- [ ] **1.1** Set up dependency injection framework (TSyringe or InversifyJS)\n- [ ] **1.2** Define core domain interfaces\n  - IServiceRepository\n  - IDeploymentRepository\n  - IContainerOrchestrator\n  - IDeploymentQueue\n  - ILogger\n  - ICache\n- [ ] **1.3** Create base error hierarchy\n  - AppError\n  - ValidationError\n  - NotFoundError\n  - UnauthorizedError\n- [ ] **1.4** Set up shared package structure\n- [ ] **1.5** Create configuration management system with validation\n- [ ] **1.6** Establish testing infrastructure\n  - Unit test setup\n  - Integration test setup\n  - Test doubles/mocks for interfaces\n\n**Success Metrics:**\n- All interfaces defined and documented\n- DI container functional\n- Test infrastructure passing\n\n### Phase 2: Domain Layer Extraction (Week 3-4)\n**Priority: P0**\n\n- [ ] **2.1** Extract domain entities\n  - Service entity\n  - Deployment entity\n  - User entity\n- [ ] **2.2** Create value objects\n  - ServiceStatus\n  - DeploymentConfig\n  - ResourceLimits\n  - EnvironmentVariables\n- [ ] **2.3** Extract business logic to domain services\n  - ServiceStatusResolver\n  - DeploymentValidator\n  - HealthChecker\n- [ ] **2.4** Remove business logic from route handlers\n- [ ] **2.5** Write comprehensive unit tests for domain layer\n\n**Success Metrics:**\n- Domain layer has 90%+ test coverage\n- No business logic in presentation layer\n- All entities properly typed\n\n### Phase 3: Infrastructure Layer Abstraction (Week 5-6)\n**Priority: P0**\n\n- [ ] **3.1** Create repository implementations\n  - ServiceRepository (wraps Prisma)\n  - DeploymentRepository\n  - UserRepository\n- [ ] **3.2** Create container orchestration abstraction\n  - DockerContainerOrchestrator implementation\n  - ContainerConfigBuilder\n  - ContainerHealthMonitor\n- [ ] **3.3** Extract shared container logic to package\n  - ContainerService\n  - VolumeManager\n  - NetworkManager\n- [ ] **3.4** Create queue abstraction\n  - BullMQAdapter\n  - DeploymentQueue\n- [ ] **3.5** Create external service clients\n  - GitHubApiClient\n  - TraefikConfigManager\n- [ ] **3.6** Write integration tests for infrastructure\n\n**Success Metrics:**\n- All infrastructure behind interfaces\n- Integration tests passing\n- Can mock entire infrastructure for testing\n\n### Phase 4: Application Layer Refactoring (Week 7-8)\n**Priority: P1**\n\n- [ ] **4.1** Create application services\n  - ServiceManagementService\n  - DeploymentOrchestrator\n  - AuthenticationService\n  - WebhookProcessor\n- [ ] **4.2** Define DTOs and validation schemas\n  - CreateServiceDto + schema\n  - UpdateServiceDto + schema\n  - DeploymentDto + schema\n- [ ] **4.3** Implement use cases\n  - CreateServiceUseCase\n  - DeployServiceUseCase\n  - GetServiceStatusUseCase\n- [ ] **4.4** Add comprehensive input validation\n- [ ] **4.5** Implement proper error handling\n- [ ] **4.6** Write application service tests\n\n**Success Metrics:**\n- Application services fully tested\n- All inputs validated\n- Proper error handling everywhere\n\n### Phase 5: Presentation Layer Cleanup (Week 9-10)\n**Priority: P1**\n\n- [ ] **5.1** Extract controllers from monolithic server.ts\n  - ServiceController\n  - DeploymentController\n  - AuthController\n  - WebhookController\n- [ ] **5.2** Create dedicated route files\n- [ ] **5.3** Implement proper middleware\n  - Authentication middleware\n  - Validation middleware\n  - Error handling middleware\n  - Rate limiting middleware\n- [ ] **5.4** Refactor SSE/WebSocket handlers\n  - MetricsStreamHandler\n  - LogStreamHandler\n- [ ] **5.5** Remove all business logic from controllers\n- [ ] **5.6** Add controller integration tests\n\n**Success Metrics:**\n- Controllers are thin (< 50 lines each)\n- All routes use proper middleware\n- Integration tests covering all endpoints\n\n### Phase 6: Worker Refactoring (Week 11-12)\n**Priority: P1**\n\n- [ ] **6.1** Implement Strategy Pattern for deployment types\n  - IDeploymentStrategy interface\n  - DockerDeploymentStrategy\n  - StaticDeploymentStrategy\n  - DatabaseDeploymentStrategy\n  - ComposeDeploymentStrategy\n- [ ] **6.2** Extract builders\n  - DockerfileBuilder\n  - ComposeFileBuilder\n- [ ] **6.3** Create DeploymentWorker orchestrator\n- [ ] **6.4** Share container logic with API via package\n- [ ] **6.5** Improve error handling and rollback\n- [ ] **6.6** Add comprehensive worker tests\n\n**Success Metrics:**\n- Worker.ts reduced to < 200 lines\n- Easy to add new deployment strategies\n- Worker tests all passing\n- Proper rollback on failures\n\n### Phase 7: Code Quality & Cleanup (Week 13-14)\n**Priority: P2**\n\n- [ ] **7.1** Remove all `any` types\n- [ ] **7.2** Add strict TypeScript compilation\n  - `strict: true`\n  - `noImplicitAny: true`\n  - `strictNullChecks: true`\n- [ ] **7.3** Extract magic numbers to constants\n- [ ] **7.4** Improve error messages and consistency\n- [ ] **7.5** Add comprehensive JSDoc comments\n- [ ] **7.6** Remove dead code and unused utilities\n- [ ] **7.7** Improve naming consistency\n\n**Success Metrics:**\n- Zero `any` types in codebase\n- Strict TypeScript compilation passes\n- All public APIs documented\n\n### Phase 8: Testing & Documentation (Week 15-16)\n**Priority: P2**\n\n- [ ] **8.1** Achieve 80%+ code coverage\n  - Unit tests for all domain/application logic\n  - Integration tests for infrastructure\n  - E2E tests for critical flows\n- [ ] **8.2** Update architecture documentation\n- [ ] **8.3** Create developer onboarding guide\n- [ ] **8.4** Document patterns and conventions\n- [ ] **8.5** Create ADRs (Architecture Decision Records)\n- [ ] **8.6** Performance testing and benchmarking\n\n**Success Metrics:**\n- 80%+ test coverage\n- All documentation updated\n- New developer can onboard in < 1 day\n\n---\n\n## ğŸ“ˆ Expected Outcomes\n\n### Quantitative Improvements\n\n| Metric | Before | Target | Improvement |\n|--------|--------|--------|-------------|\n| Lines in server.ts | 1,882 | < 200 | 90% reduction |\n| Lines in worker.ts | 565 | < 200 | 65% reduction |\n| Test Coverage | ~40% | > 80% | 100% increase |\n| `any` type usage | 50+ | 0 | 100% reduction |\n| Avg. Function Length | 80 LOC | < 20 LOC | 75% reduction |\n| Cyclomatic Complexity | High | Low | 60% reduction |\n| Time to Add Feature | 2-3 days | < 1 day | 60% faster |\n| Bug Introduction Rate | High | Low | 70% reduction |\n| Onboarding Time | 2 weeks | 2 days | 85% reduction |\n\n### Qualitative Improvements\n\nâœ… **Maintainability**\n- Easy to understand and modify\n- Clear separation of concerns\n- Single source of truth for business logic\n\nâœ… **Testability**\n- All components testable in isolation\n- Fast, reliable test suite\n- High test coverage\n\nâœ… **Scalability**\n- Easy to add new features\n- Simple to add new service types\n- Can scale team without chaos\n\nâœ… **Reliability**\n- Consistent error handling\n- Proper resource cleanup\n- Robust rollback mechanisms\n\nâœ… **Security**\n- Centralized security logic\n- Easy to audit\n- Consistent validation\n\nâœ… **Developer Experience**\n- Fast onboarding\n- Clear patterns to follow\n- Good documentation\n- Helpful error messages\n\n---\n\n## âš ï¸ Risks & Mitigation\n\n### Risk 1: Breaking Changes During Refactoring\n**Likelihood:** High | **Impact:** High\n\n**Mitigation:**\n- Comprehensive test suite before refactoring\n- Incremental changes with frequent testing\n- Feature flags for gradual rollout\n- Parallel implementation when needed\n\n### Risk 2: Team Productivity Drop\n**Likelihood:** Medium | **Impact:** Medium\n\n**Mitigation:**\n- Refactor in dedicated sprints\n- Pair programming for knowledge transfer\n- Clear documentation\n- Regular sync meetings\n\n### Risk 3: Scope Creep\n**Likelihood:** Medium | **Impact:** Medium\n\n**Mitigation:**\n- Strict adherence to phases\n- Clear acceptance criteria\n- Regular reviews\n- YAGNI principle enforcement\n\n### Risk 4: Testing Coverage Gaps\n**Likelihood:** Medium | **Impact:** High\n\n**Mitigation:**\n- Write tests first (TDD approach)\n- Code coverage requirements\n- Manual testing checklist\n- E2E test suite\n\n---\n\n## ğŸ¯ Acceptance Criteria\n\n### Phase Completion Criteria\n\n**Each phase must meet:**\n- [ ] All tasks completed\n- [ ] Tests passing (unit + integration)\n- [ ] Code review approved\n- [ ] Documentation updated\n- [ ] No regression in existing functionality\n- [ ] Performance benchmarks met or improved\n\n### Overall Epic Completion Criteria\n\n- [ ] **Architecture:**\n  - Clear layered architecture implemented\n  - All SOLID principles followed\n  - No DRY violations\n  - YAGNI principle applied throughout\n\n- [ ] **Code Quality:**\n  - Zero `any` types\n  - Strict TypeScript compilation\n  - ESLint with no warnings\n  - Prettier formatting\n  - All functions < 50 lines\n  - All files < 300 lines\n\n- [ ] **Testing:**\n  - 80%+ code coverage\n  - All critical paths tested\n  - Integration tests for all layers\n  - E2E tests for user journeys\n\n- [ ] **Documentation:**\n  - Architecture diagrams\n  - API documentation\n  - Developer guide\n  - Pattern guide\n  - ADRs for major decisions\n\n- [ ] **Performance:**\n  - No performance regression\n  - Response times < 200ms (p95)\n  - Memory usage stable\n\n- [ ] **Security:**\n  - All security issues addressed\n  - Security audit passing\n  - Input validation comprehensive\n\n---\n\n## ğŸ“š References & Resources\n\n### Books\n- Clean Architecture by Robert C. Martin\n- Domain-Driven Design by Eric Evans\n- Refactoring by Martin Fowler\n- Patterns of Enterprise Application Architecture by Martin Fowler\n\n### Principles\n- [SOLID Principles](https://en.wikipedia.org/wiki/SOLID)\n- [DRY Principle](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself)\n- [YAGNI Principle](https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it)\n- [Clean Code Principles](https://www.oreilly.com/library/view/clean-code-a/9780136083238/)\n\n### Patterns\n- Strategy Pattern for deployment types\n- Repository Pattern for data access\n- Dependency Injection for loose coupling\n- Factory Pattern for object creation\n- Observer Pattern for event handling\n\n---\n\n## ğŸš€ Getting Started\n\n### For Contributors\n\n1. **Read the Architecture Document:** Understand the current and target state\n2. **Review Phase 1 Tasks:** Foundation work must be done first\n3. **Set up Development Environment:** Ensure all tests pass\n4. **Pick a Task:** Start with Phase 1 items\n5. **Write Tests First:** TDD approach recommended\n6. **Submit Small PRs:** Incremental changes for easier review\n\n### For Reviewers\n\n- **Check Principles:** Ensure SOLID, DRY, YAGNI followed\n- **Review Tests:** Must have comprehensive test coverage\n- **Verify Documentation:** All public APIs documented\n- **Performance:** No regression in benchmarks\n- **Security:** No new vulnerabilities introduced\n\n---\n\n## ğŸ’¬ Discussion & Feedback\n\nThis is a living document. As we progress through the refactoring:\n\n- **Weekly Reviews:** Adjust plan based on learnings\n- **Retrospectives:** What's working, what's not\n- **Architecture Reviews:** Major decisions documented in ADRs\n- **Team Feedback:** Open to suggestions and improvements\n\n---\n\n## ğŸ“Š Progress Tracking\n\n- **Phase 1:** ğŸ”´ Not Started (0%)\n- **Phase 2:** ğŸ”´ Not Started (0%)\n- **Phase 3:** ğŸ”´ Not Started (0%)\n- **Phase 4:** ğŸ”´ Not Started (0%)\n- **Phase 5:** ğŸ”´ Not Started (0%)\n- **Phase 6:** ğŸ”´ Not Started (0%)\n- **Phase 7:** ğŸ”´ Not Started (0%)\n- **Phase 8:** ğŸ”´ Not Started (0%)\n\n**Overall Progress:** 0% Complete\n\n---\n\n**Priority:** P0 - Critical\n**Estimated Effort:** 16 weeks (4 months)\n**Team Size:** 2-4 engineers\n**Dependencies:** None (can start immediately)\n**Blockers:** None",
    "number": 94,
    "state": "OPEN",
    "url": "https://github.com/ramiz4/helvetia-cloud/issues/94",
    "synced": false
  }
]
